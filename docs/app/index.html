<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cycle Overlay Status</title>
    <style>
      :root {
        color-scheme: light;
        font-family: "Iowan Old Style", "Palatino", "Palatino Linotype", "Book Antiqua", serif;
        --bg: #f6f2ea;
        --card: #fffaf2;
        --ink: #2b2418;
        --muted: #6c604f;
        --accent: #c94a2b;
        --border: #e5d9c5;
      }
      body {
        margin: 0;
        background: radial-gradient(circle at top, #fff7e9, #efe6d6 55%, #e6dbc7);
        color: var(--ink);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 32px 16px;
      }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 18px;
        box-shadow: 0 14px 30px rgba(43, 36, 24, 0.12);
        padding: 28px;
        max-width: 520px;
        width: 100%;
      }
      h1 {
        margin: 0 0 12px;
        font-size: 28px;
        letter-spacing: 0.5px;
      }
      .meta {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 20px;
      }
      dl {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px 18px;
        margin: 0 0 20px;
      }
      dt {
        color: var(--muted);
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }
      dd {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
      }
      .actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }
      button {
        border: 1px solid var(--border);
        background: var(--ink);
        color: #fff;
        border-radius: 12px;
        padding: 10px 16px;
        font-size: 15px;
        cursor: pointer;
        transition: transform 0.1s ease, box-shadow 0.1s ease;
      }
      button.secondary {
        background: transparent;
        color: var(--ink);
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      button:active {
        transform: translateY(1px);
      }
      .message {
        margin-top: 16px;
        font-size: 14px;
      }
      .message.success {
        color: #2f7a3f;
      }
      .message.error {
        color: #b0322b;
      }
      @media (max-width: 520px) {
        dl {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Cycle Overlay</h1>
      <div class="meta">Live status from your worker</div>

      <dl>
        <dt>Today</dt>
        <dd id="today">‚Äî</dd>
        <dt>Last Period Start</dt>
        <dd id="lastStart">‚Äî</dd>
        <dt>Cycle Day</dt>
        <dd id="cycleDay">‚Äî</dd>
        <dt>Phase</dt>
        <dd id="phase">‚Äî</dd>
      </dl>

      <div class="actions">
        <button id="startBtn">ü©∏ Day 1 today</button>
        <button id="undoBtn" class="secondary">‚Ü©Ô∏è Undo</button>
      </div>

      <div id="message" class="message"></div>
    </div>

    <script>
      const WORKER_BASE_URL = "https://cycle-overlay-api.ksenia-ilinyh.workers.dev";
      const API_KEY = "untangle-chose-156-needy-thieves";

      const todayEl = document.getElementById("today");
      const lastStartEl = document.getElementById("lastStart");
      const cycleDayEl = document.getElementById("cycleDay");
      const phaseEl = document.getElementById("phase");
      const messageEl = document.getElementById("message");
      const startBtn = document.getElementById("startBtn");
      const undoBtn = document.getElementById("undoBtn");

      function setMessage(text, type) {
        messageEl.textContent = text;
        messageEl.className = `message ${type || ""}`.trim();
      }

      function formatDate(date) {
        return date.toISOString().slice(0, 10);
      }

      async function fetchStatus() {
        setMessage("", "");
        try {
          const response = await fetch(`${WORKER_BASE_URL}/status?key=${API_KEY}`);
          if (!response.ok) {
            throw new Error(`Status request failed (${response.status})`);
          }
          const data = await response.json();
          todayEl.textContent = formatDate(new Date());
          lastStartEl.textContent = data.last_period_start || "‚Äî";
          cycleDayEl.textContent = data.current_day || "‚Äî";
          phaseEl.textContent = data.current_phase || "‚Äî";
        } catch (error) {
          setMessage(error.message, "error");
        }
      }

      async function postAction(path, successMessage) {
        setMessage("", "");
        startBtn.disabled = true;
        undoBtn.disabled = true;
        try {
          const response = await fetch(`${WORKER_BASE_URL}/${path}?key=${API_KEY}`, {
            method: "POST",
          });
          if (!response.ok) {
            throw new Error(`Request failed (${response.status})`);
          }
          setMessage(successMessage, "success");
          await fetchStatus();
        } catch (error) {
          setMessage(error.message, "error");
        } finally {
          startBtn.disabled = false;
          undoBtn.disabled = false;
        }
      }

      startBtn.addEventListener("click", () => postAction("start", "Marked Day 1."));
      undoBtn.addEventListener("click", () => postAction("undo", "Undo complete."));

      fetchStatus();
    </script>
  </body>
</html>
